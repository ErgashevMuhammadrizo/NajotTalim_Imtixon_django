{% extends 'base.html' %}
{% load static %}
{% load i18n %}

{% block title %}{% trans "Ro'yxatdan o'tish" %}{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6">
            <!-- Registration Card -->
            <div class="card border-0 shadow-lg">
                <!-- Card Header -->
                <div class="card-header bg-primary text-white py-4">
                    <div class="d-flex align-items-center">
                        <div class="registration-icon me-3">
                            <i class="fas fa-user-plus fa-2x"></i>
                        </div>
                        <div>
                            <h2 class="h4 mb-0">{% trans "Yangi hisob yaratish" %}</h2>
                            <p class="small mb-0 opacity-75">{% trans "30 soniya ichida ro'yxatdan o'ting" %}</p>
                        </div>
                    </div>
                </div>
                
                <!-- Card Body -->
                <div class="card-body p-4 p-md-5">
                    <!-- Social Registration (Optional) -->
                    <div class="text-center mb-4">
                        <p class="text-muted mb-3">{% trans "Ijtimoiy tarmoqlar orqali ro'yxatdan o'ting" %}</p>
                        <div class="d-flex justify-content-center gap-3">
                            <button type="button" class="btn btn-outline-primary btn-sm social-btn">
                                <i class="fab fa-google me-2"></i> Google
                            </button>
                            <button type="button" class="btn btn-outline-primary btn-sm social-btn">
                                <i class="fab fa-facebook me-2"></i> Facebook
                            </button>
                            <button type="button" class="btn btn-outline-primary btn-sm social-btn">
                                <i class="fab fa-telegram me-2"></i> Telegram
                            </button>
                        </div>
                    </div>
                    
                    <!-- Divider -->
                    <div class="position-relative my-4">
                        <hr>
                        <div class="divider-text">{% trans "yoki" %}</div>
                    </div>
                    
                    <!-- Registration Form -->
                    <form method="post" novalidate class="needs-validation">
                        {% csrf_token %}
                        
                        {% if form.non_field_errors %}
                        <div class="alert alert-danger">
                            {% for error in form.non_field_errors %}
                            <p class="mb-0"><i class="fas fa-exclamation-circle me-2"></i> {{ error }}</p>
                            {% endfor %}
                        </div>
                        {% endif %}
                        
                        <!-- Username -->
                        <div class="mb-4">
                            <label for="id_username" class="form-label fw-semibold">
                                <i class="fas fa-user me-2 text-primary"></i>{% trans "Foydalanuvchi nomi" %}
                            </label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-at"></i></span>
                                <input type="text" name="username" id="id_username" 
                                       class="form-control {% if form.username.errors %}is-invalid{% endif %}"
                                       placeholder="{% trans 'username' %}"
                                       value="{{ form.username.value|default:'' }}"
                                       required>
                                <div class="valid-feedback">
                                    {% trans "Yaxshi tanlov!" %}
                                </div>
                                <div class="invalid-feedback">
                                    {% if form.username.errors %}
                                        {{ form.username.errors.0 }}
                                    {% else %}
                                        {% trans "Foydalanuvchi nomini kiriting" %}
                                    {% endif %}
                                </div>
                            </div>
                            <small class="form-text text-muted">{% trans "Bu nom profilingizda ko'rinadi" %}</small>
                        </div>
                        
                        <!-- Email -->
                        <div class="mb-4">
                            <label for="id_email" class="form-label fw-semibold">
                                <i class="fas fa-envelope me-2 text-primary"></i>{% trans "Email manzil" %}
                            </label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-mail-bulk"></i></span>
                                <input type="email" name="email" id="id_email" 
                                       class="form-control {% if form.email.errors %}is-invalid{% endif %}"
                                       placeholder="example@mail.com"
                                       value="{{ form.email.value|default:'' }}"
                                       required>
                                <div class="invalid-feedback">
                                    {% if form.email.errors %}
                                        {{ form.email.errors.0 }}
                                    {% else %}
                                        {% trans "To'g'ri email manzil kiriting" %}
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        
                        <!-- First Name & Last Name -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <label for="id_first_name" class="form-label fw-semibold">
                                    {% trans "Ism" %}
                                </label>
                                <input type="text" name="first_name" id="id_first_name" 
                                       class="form-control {% if form.first_name.errors %}is-invalid{% endif %}"
                                       placeholder="{% trans 'Aziz' %}"
                                       value="{{ form.first_name.value|default:'' }}">
                            </div>
                            <div class="col-md-6">
                                <label for="id_last_name" class="form-label fw-semibold">
                                    {% trans "Familiya" %}
                                </label>
                                <input type="text" name="last_name" id="id_last_name" 
                                       class="form-control {% if form.last_name.errors %}is-invalid{% endif %}"
                                       placeholder="{% trans 'Siddiqov' %}"
                                       value="{{ form.last_name.value|default:'' }}">
                            </div>
                        </div>
                        
                        <!-- Phone -->
                        <div class="mb-4">
                            <label for="id_phone" class="form-label fw-semibold">
                                <i class="fas fa-phone me-2 text-primary"></i>{% trans "Telefon raqam" %}
                            </label>
                            <div class="input-group">
                                <span class="input-group-text">+998</span>
                                <input type="tel" name="phone" id="id_phone" 
                                       class="form-control {% if form.phone.errors %}is-invalid{% endif %}"
                                       placeholder="90 123 45 67"
                                       value="{{ form.phone.value|default:'' }}">
                                <div class="invalid-feedback">
                                    {% if form.phone.errors %}
                                        {{ form.phone.errors.0 }}
                                    {% endif %}
                                </div>
                            </div>
                            <small class="form-text text-muted">{% trans "Ixtiyoriy. Faollashtirish uchun ishlatiladi" %}</small>
                        </div>
                        
                        <!-- Password -->
                        <div class="mb-4">
                            <label for="id_password1" class="form-label fw-semibold">
                                <i class="fas fa-lock me-2 text-primary"></i>{% trans "Parol" %}
                            </label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-key"></i></span>
                                <input type="password" name="password1" id="id_password1" 
                                       class="form-control {% if form.password1.errors %}is-invalid{% endif %}"
                                       placeholder="{% trans 'Kuchli parol yarating' %}"
                                       required>
                                <button type="button" class="btn btn-outline-secondary toggle-password" 
                                        data-target="id_password1">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <div class="invalid-feedback">
                                    {% if form.password1.errors %}
                                        {{ form.password1.errors.0 }}
                                    {% endif %}
                                </div>
                            </div>
                            <div class="password-strength mt-2">
                                <div class="progress" style="height: 5px;">
                                    <div class="progress-bar" id="password-strength-bar" style="width: 0%"></div>
                                </div>
                                <small id="password-strength-text" class="form-text"></small>
                            </div>
                            <ul class="password-requirements mt-2 small text-muted">
                                <li id="req-length"><i class="fas fa-circle text-danger me-1"></i> {% trans "Kamida 8 ta belgi" %}</li>
                                <li id="req-upper"><i class="fas fa-circle text-danger me-1"></i> {% trans "Kamida 1 ta katta harf" %}</li>
                                <li id="req-number"><i class="fas fa-circle text-danger me-1"></i> {% trans "Kamida 1 ta raqam" %}</li>
                            </ul>
                        </div>
                        
                        <!-- Confirm Password -->
                        <div class="mb-4">
                            <label for="id_password2" class="form-label fw-semibold">
                                <i class="fas fa-lock me-2 text-primary"></i>{% trans "Parolni tasdiqlash" %}
                            </label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-key"></i></span>
                                <input type="password" name="password2" id="id_password2" 
                                       class="form-control {% if form.password2.errors %}is-invalid{% endif %}"
                                       placeholder="{% trans 'Parolni takrorlang' %}"
                                       required>
                                <button type="button" class="btn btn-outline-secondary toggle-password" 
                                        data-target="id_password2">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <div class="invalid-feedback">
                                    {% if form.password2.errors %}
                                        {{ form.password2.errors.0 }}
                                    {% endif %}
                                </div>
                            </div>
                            <small id="password-match" class="form-text text-danger d-none">
                                <i class="fas fa-times-circle me-1"></i> {% trans "Parollar mos emas" %}
                            </small>
                            <small id="password-match-success" class="form-text text-success d-none">
                                <i class="fas fa-check-circle me-1"></i> {% trans "Parollar mos" %}
                            </small>
                        </div>
                        
                        <!-- Terms & Privacy -->
                        <div class="mb-4">
                            <div class="form-check">
                                <input class="form-check-input {% if form.terms.errors %}is-invalid{% endif %}" 
                                       type="checkbox" id="terms" name="terms" required>
                                <label class="form-check-label" for="terms">
                                    {% trans "Men" %} 
                                    <a href="#" class="text-decoration-none">{% trans "Foydalanish shartlari" %}</a>
                                    {% trans "va" %}
                                    <a href="#" class="text-decoration-none">{% trans "Maxfiylik siyosati" %}</a>
                                    {% trans "bilan tanishdim va roziman" %}
                                </label>
                                <div class="invalid-feedback">
                                    {% trans "Davom etish uchun shartlar bilan rozilik bildirishingiz kerak" %}
                                </div>
                            </div>
                        </div>
                        
                        <!-- Submit Button -->
                        <div class="d-grid mb-4">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fas fa-user-plus me-2"></i> {% trans "Ro'yxatdan o'tish" %}
                            </button>
                        </div>
                        
                        <!-- Additional Options -->
                        <div class="text-center">
                            <p class="mb-0">
                                {% trans "Allaqachon hisobingiz bormi?" %}
                                <a href="{% url 'users:login' %}" class="text-decoration-none fw-semibold">
                                    {% trans "Kirish" %}
                                </a>
                            </p>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Security Info -->
            <div class="card border-0 shadow-sm mt-4">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="me-3 text-success">
                            <i class="fas fa-shield-alt fa-2x"></i>
                        </div>
                        <div>
                            <h6 class="mb-1">{% trans "Xavfsizlik kafolati" %}</h6>
                            <p class="small text-muted mb-0">
                                {% trans "Barcha ma'lumotlaringiz shifrlangan holda saqlanadi. Biz hech qachon parolingizni saqlamaymiz." %}
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .registration-icon {
        background: rgba(255, 255, 255, 0.2);
        width: 60px;
        height: 60px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .social-btn {
        min-width: 110px;
    }
    
    .divider-text {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        padding: 0 15px;
        color: #6c757d;
        font-size: 14px;
    }
    
    .password-strength .progress-bar {
        transition: width 0.3s ease;
    }
    
    .password-requirements li {
        list-style: none;
        margin-bottom: 3px;
    }
    
    .password-requirements .fa-circle {
        font-size: 8px;
        vertical-align: middle;
    }
    
    .form-control:focus {
        box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
        border-color: #86b7fe;
    }
    
    .input-group-text {
        background-color: #f8f9fa;
        border-color: #ced4da;
    }
    
    .toggle-password {
        border-left: 0;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Toggle password visibility
        document.querySelectorAll('.toggle-password').forEach(button => {
            button.addEventListener('click', function() {
                const targetId = this.getAttribute('data-target');
                const passwordInput = document.getElementById(targetId);
                const icon = this.querySelector('i');
                
                if (passwordInput.type === 'password') {
                    passwordInput.type = 'text';
                    icon.classList.remove('fa-eye');
                    icon.classList.add('fa-eye-slash');
                } else {
                    passwordInput.type = 'password';
                    icon.classList.remove('fa-eye-slash');
                    icon.classList.add('fa-eye');
                }
            });
        });
        
        // Password strength checker
        const password1 = document.getElementById('id_password1');
        const password2 = document.getElementById('id_password2');
        const strengthBar = document.getElementById('password-strength-bar');
        const strengthText = document.getElementById('password-strength-text');
        
        const requirements = {
            length: document.getElementById('req-length'),
            upper: document.getElementById('req-upper'),
            number: document.getElementById('req-number')
        };
        
        password1.addEventListener('input', function() {
            checkPasswordStrength(this.value);
            checkPasswordMatch();
        });
        
        password2.addEventListener('input', checkPasswordMatch);
        
        function checkPasswordStrength(password) {
            let strength = 0;
            let color = '#dc3545'; // Red
            let text = "{% trans 'Zaif' %}";
            
            // Check length
            if (password.length >= 8) {
                strength += 33;
                requirements.length.querySelector('i').className = 'fas fa-check-circle text-success me-1';
            } else {
                requirements.length.querySelector('i').className = 'fas fa-times-circle text-danger me-1';
            }
            
            // Check uppercase
            if (/[A-Z]/.test(password)) {
                strength += 33;
                requirements.upper.querySelector('i').className = 'fas fa-check-circle text-success me-1';
            } else {
                requirements.upper.querySelector('i').className = 'fas fa-times-circle text-danger me-1';
            }
            
            // Check number
            if (/[0-9]/.test(password)) {
                strength += 34;
                requirements.number.querySelector('i').className = 'fas fa-check-circle text-success me-1';
            } else {
                requirements.number.querySelector('i').className = 'fas fa-times-circle text-danger me-1';
            }
            
            // Determine strength level
            if (strength > 66) {
                color = '#28a745'; // Green
                text = "{% trans 'Kuchli' %}";
            } else if (strength > 33) {
                color = '#ffc107'; // Yellow
                text = "{% trans 'OÊ»rtacha' %}";
            }
            
            strengthBar.style.width = strength + '%';
            strengthBar.style.backgroundColor = color;
            strengthText.textContent = text + ': ' + strength + '%';
            strengthText.style.color = color;
        }
        
        function checkPasswordMatch() {
            const matchText = document.getElementById('password-match');
            const matchSuccess = document.getElementById('password-match-success');
            
            if (password1.value && password2.value) {
                if (password1.value === password2.value) {
                    matchText.classList.add('d-none');
                    matchSuccess.classList.remove('d-none');
                } else {
                    matchText.classList.remove('d-none');
                    matchSuccess.classList.add('d-none');
                }
            } else {
                matchText.classList.add('d-none');
                matchSuccess.classList.add('d-none');
            }
        }
        
        // Form validation
        const form = document.querySelector('form.needs-validation');
        form.addEventListener('submit', function(event) {
            if (!form.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
            }
            form.classList.add('was-validated');
        }, false);
    });
</script>
{% endblock %}